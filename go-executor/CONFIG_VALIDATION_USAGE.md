# çŽ¯å¢ƒå˜é‡æ ¡éªŒåŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ðŸ“‹ åŠŸèƒ½ç®€ä»‹

ä»Žæœ¬ç‰ˆæœ¬å¼€å§‹ï¼Œå½“çŽ¯å¢ƒå˜é‡é…ç½®é”™è¯¯æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è®°å½•è­¦å‘Šæ—¥å¿—ï¼Œå¸®åŠ©æ‚¨å¿«é€Ÿå‘çŽ°å’Œå®šä½é…ç½®é—®é¢˜ã€‚

---

## ðŸŽ¯ å…¸åž‹åœºæ™¯

### åœºæ™¯ 1: æ‹¼å†™é”™è¯¯

**é…ç½®æ–‡ä»¶ (`.env`)**:
```bash
RUNTIME_POOL_SIZE=100abc  # â† ä¸å°å¿ƒå¤šè¾“å…¥äº† "abc"
```

**å¯åŠ¨æ—¥å¿—**:
```
[WARN] çŽ¯å¢ƒå˜é‡è§£æžå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼
  key: RUNTIME_POOL_SIZE
  invalid_value: 100abc
  default: 100
  error: strconv.Atoi: parsing "100abc": invalid syntax
```

**å¤„ç†å»ºè®®**: ä¿®æ”¹é…ç½®ä¸º `RUNTIME_POOL_SIZE=100`

---

### åœºæ™¯ 2: å•ä½é”™è¯¯

**é…ç½®æ–‡ä»¶**:
```bash
EXECUTION_TIMEOUT_MS=10s  # â† é”™è¯¯ï¼šåº”è¯¥æ˜¯æ¯«ç§’æ•°å­—ï¼Œä¸èƒ½å¸¦å•ä½
```

**å¯åŠ¨æ—¥å¿—**:
```
[WARN] çŽ¯å¢ƒå˜é‡è§£æžå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼
  key: EXECUTION_TIMEOUT_MS
  invalid_value: 10s
  default: 300000
  error: strconv.Atoi: parsing "10s": invalid syntax
```

**å¤„ç†å»ºè®®**: ä¿®æ”¹é…ç½®ä¸º `EXECUTION_TIMEOUT_MS=10000`ï¼ˆ10ç§’ = 10000æ¯«ç§’ï¼‰

---

### åœºæ™¯ 3: èŒƒå›´é”™è¯¯

**é…ç½®æ–‡ä»¶**:
```bash
MIN_RUNTIME_POOL_SIZE=5  # â† å¤ªå°äº†ï¼Œæœ€å°å€¼æ˜¯ 10
```

**å¯åŠ¨æ—¥å¿—**:
```
[WARN] MIN_RUNTIME_POOL_SIZE è¿‡å°ï¼Œå·²è°ƒæ•´
  original: 5
  adjusted: 10
  reason: æœ€å°å€¼ä¸èƒ½ä½ŽäºŽ 10
```

**å¤„ç†å»ºè®®**: ä¿®æ”¹é…ç½®ä¸º `MIN_RUNTIME_POOL_SIZE=50`ï¼ˆæŽ¨èå€¼ï¼‰

---

### åœºæ™¯ 4: é…ç½®å†²çª

**é…ç½®æ–‡ä»¶**:
```bash
MIN_RUNTIME_POOL_SIZE=100
MAX_RUNTIME_POOL_SIZE=50   # â† é”™è¯¯ï¼šæœ€å¤§å€¼ä¸èƒ½å°äºŽæœ€å°å€¼
RUNTIME_POOL_SIZE=150      # â† è¶…å‡ºæœ€å¤§å€¼
```

**å¯åŠ¨æ—¥å¿—**:
```
[WARN] MAX_RUNTIME_POOL_SIZE å°äºŽ MIN_RUNTIME_POOL_SIZEï¼Œå·²è°ƒæ•´
  min_pool_size: 100
  original_max: 50
  adjusted_max: 200

[WARN] RUNTIME_POOL_SIZE å¤§äºŽ MAX_RUNTIME_POOL_SIZEï¼Œå·²è°ƒæ•´
  original: 150
  adjusted: 200
```

**å¤„ç†å»ºè®®**: ä¿®æ”¹é…ç½®
```bash
MIN_RUNTIME_POOL_SIZE=50
MAX_RUNTIME_POOL_SIZE=200
RUNTIME_POOL_SIZE=100
```

---

## ðŸ“ é…ç½®è§„èŒƒ

### æ•´æ•°ç±»åž‹é…ç½®

æ‰€æœ‰æ•´æ•°é…ç½®å¿…é¡»æ˜¯**çº¯æ•°å­—**ï¼Œä¸èƒ½åŒ…å«ï¼š
- âŒ å­—æ¯ï¼š`100abc`, `2k`, `500MB`
- âŒ å•ä½ï¼š`10s`, `5m`, `1h`
- âŒ ä¸­æ–‡ï¼š`2åƒ`, `ä¸€ç™¾`
- âŒ ç‰¹æ®Šå­—ç¬¦ï¼š`1,000`, `100_000`

âœ… **æ­£ç¡®ç¤ºä¾‹**:
```bash
RUNTIME_POOL_SIZE=100
MAX_CONCURRENT_EXECUTIONS=2000
EXECUTION_TIMEOUT_MS=300000
MAX_CODE_LENGTH=65535
MAX_INPUT_SIZE=2097152
MAX_RESULT_SIZE=5242880
```

### é…ç½®å•ä½è¯´æ˜Ž

| é…ç½®é¡¹ | å•ä½ | è¯´æ˜Ž | ç¤ºä¾‹ |
|--------|------|------|------|
| `RUNTIME_POOL_SIZE` | ä¸ªæ•° | Runtime æ± å¤§å° | `100` |
| `MAX_CONCURRENT_EXECUTIONS` | ä¸ªæ•° | æœ€å¤§å¹¶å‘æ•° | `2000` |
| `EXECUTION_TIMEOUT_MS` | æ¯«ç§’ | è¶…æ—¶æ—¶é—´ | `300000` (5åˆ†é’Ÿ) |
| `MAX_CODE_LENGTH` | å­—èŠ‚ | ä»£ç é•¿åº¦é™åˆ¶ | `65535` (64KB) |
| `MAX_INPUT_SIZE` | å­—èŠ‚ | è¾“å…¥å¤§å°é™åˆ¶ | `2097152` (2MB) |
| `MAX_RESULT_SIZE` | å­—èŠ‚ | ç»“æžœå¤§å°é™åˆ¶ | `5242880` (5MB) |
| `RUNTIME_IDLE_TIMEOUT_MIN` | åˆ†é’Ÿ | ç©ºé—²è¶…æ—¶ | `5` |

### å¸¸ç”¨å•ä½æ¢ç®—

**æ—¶é—´**:
```bash
1 ç§’ = 1000 æ¯«ç§’
1 åˆ†é’Ÿ = 60000 æ¯«ç§’
5 åˆ†é’Ÿ = 300000 æ¯«ç§’ï¼ˆé»˜è®¤è¶…æ—¶ï¼‰
```

**å¤§å°**:
```bash
1 KB = 1024 å­—èŠ‚
1 MB = 1048576 å­—èŠ‚
2 MB = 2097152 å­—èŠ‚ï¼ˆé»˜è®¤è¾“å…¥é™åˆ¶ï¼‰
5 MB = 5242880 å­—èŠ‚ï¼ˆé»˜è®¤ç»“æžœé™åˆ¶ï¼‰
64 KB = 65535 å­—èŠ‚ï¼ˆé»˜è®¤ä»£ç é™åˆ¶ï¼‰
```

---

## ðŸ” å¦‚ä½•æµ‹è¯•é…ç½®

### æ–¹æ³• 1: ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
cd go-executor
./test_config_validation.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. è®¾ç½®å„ç§é”™è¯¯é…ç½®
2. å¯åŠ¨æœåŠ¡
3. æ˜¾ç¤ºé¢„æœŸçš„è­¦å‘Šæ—¥å¿—

### æ–¹æ³• 2: æ‰‹åŠ¨æµ‹è¯•

1. ä¿®æ”¹ `.env` æ–‡ä»¶ï¼Œæ•…æ„å†™é”™ä¸€ä¸ªé…ç½®
   ```bash
   RUNTIME_POOL_SIZE=100abc
   ```

2. å¯åŠ¨æœåŠ¡
   ```bash
   cd go-executor
   go run cmd/main.go
   ```

3. è§‚å¯Ÿå¯åŠ¨æ—¥å¿—ï¼Œåº”è¯¥çœ‹åˆ°è­¦å‘Šä¿¡æ¯
   ```
   [WARN] çŽ¯å¢ƒå˜é‡è§£æžå¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼
   ```

4. ä¿®æ­£é…ç½®ï¼Œé‡å¯æœåŠ¡ï¼Œè­¦å‘Šåº”è¯¥æ¶ˆå¤±

---

## âœ… æœ€ä½³å®žè·µ

### 1. å®šæœŸæ£€æŸ¥å¯åŠ¨æ—¥å¿—

æœåŠ¡å¯åŠ¨æ—¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰ `[WARN]` æ—¥å¿—ï¼ŒåŠæ—¶ä¿®æ­£é…ç½®ã€‚

### 2. ä½¿ç”¨ `env.example` ä½œä¸ºæ¨¡æ¿

å¤åˆ¶ `env.example` å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹ï¼š
```bash
cp env.example .env
nano .env
```

### 3. é…ç½®èŒƒå›´å‚è€ƒ

å‚è€ƒ `env.example` ä¸­çš„æ³¨é‡Šï¼Œäº†è§£æ¯ä¸ªé…ç½®çš„æŽ¨èèŒƒå›´ï¼š

```bash
# æœ€å° Runtime æ± å¤§å°ï¼ˆé»˜è®¤ï¼š50ï¼‰
# å¼ºåˆ¶æœ€å°å€¼ï¼š10
MIN_RUNTIME_POOL_SIZE=50

# æœ€å¤§ Runtime æ± å¤§å°ï¼ˆé»˜è®¤ï¼š200ï¼‰
# è‡ªåŠ¨è°ƒæ•´ï¼šå¦‚æžœå°äºŽ MIN_RUNTIME_POOL_SIZEï¼Œä¼šè®¾ä¸º MIN_RUNTIME_POOL_SIZE * 2
MAX_RUNTIME_POOL_SIZE=200
```

### 4. çŽ¯å¢ƒåˆ†ç¦»

ä¸åŒçŽ¯å¢ƒä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼š

**å¼€å‘çŽ¯å¢ƒ**:
```bash
cp env.development .env
```

**ç”Ÿäº§çŽ¯å¢ƒ**:
```bash
cp env.production .env
```

### 5. é…ç½®éªŒè¯æ¸…å•

åœ¨éƒ¨ç½²å‰ï¼Œæ£€æŸ¥ä»¥ä¸‹é…ç½®é¡¹ï¼š

- [ ] æ‰€æœ‰æ•´æ•°é…ç½®éƒ½æ˜¯çº¯æ•°å­—ï¼ˆæ— å­—æ¯ã€å•ä½ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- [ ] `MIN_RUNTIME_POOL_SIZE >= 10`
- [ ] `MAX_RUNTIME_POOL_SIZE >= MIN_RUNTIME_POOL_SIZE`
- [ ] `MIN_RUNTIME_POOL_SIZE <= RUNTIME_POOL_SIZE <= MAX_RUNTIME_POOL_SIZE`
- [ ] `EXECUTION_TIMEOUT_MS` é€‚åˆä¸šåŠ¡åœºæ™¯ï¼ˆå¿«é€Ÿä»»åŠ¡ 10000ï¼Œé•¿ä»»åŠ¡ 300000ï¼‰
- [ ] `MAX_CONCURRENT_EXECUTIONS >= RUNTIME_POOL_SIZE`

---

## ðŸ› å¸¸è§é—®é¢˜

### Q1: æˆ‘è®¾ç½®äº†é…ç½®ï¼Œä½†å¯åŠ¨æ—¥å¿—æ˜¾ç¤º"ä½¿ç”¨é»˜è®¤å€¼"ï¼Ÿ

**åŽŸå› **: é…ç½®å€¼æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è§£æžä¸ºæ•´æ•°ã€‚

**è§£å†³**: æ£€æŸ¥é…ç½®å€¼æ˜¯å¦åŒ…å«éžæ•°å­—å­—ç¬¦ï¼Œå‚è€ƒ"é…ç½®è§„èŒƒ"éƒ¨åˆ†ä¿®æ­£ã€‚

---

### Q2: ä¸ºä»€ä¹ˆæˆ‘çš„é…ç½®è¢«è‡ªåŠ¨è°ƒæ•´äº†ï¼Ÿ

**åŽŸå› **: é…ç½®å€¼è¶…å‡ºæœ‰æ•ˆèŒƒå›´ï¼Œç³»ç»Ÿè‡ªåŠ¨è°ƒæ•´åˆ°å®‰å…¨å€¼ã€‚

**è§£å†³**: æŸ¥çœ‹è­¦å‘Šæ—¥å¿—ä¸­çš„ `adjusted` å€¼ï¼Œç†è§£ä¸ºä»€ä¹ˆè¢«è°ƒæ•´ï¼Œç„¶åŽä¿®æ”¹é…ç½®åˆ°åˆç†èŒƒå›´ã€‚

---

### Q3: ç©ºå€¼ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ä¼šè§¦å‘è­¦å‘Šå—ï¼Ÿ

**å›žç­”**: ä¸ä¼šã€‚ç©ºå€¼æ˜¯åˆæ³•çš„ï¼Œè¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ï¼Œä¸ä¼šè®°å½•è­¦å‘Šã€‚

```bash
# è¿™äº›éƒ½ä¸ä¼šè§¦å‘è­¦å‘Šï¼ˆä½¿ç”¨é»˜è®¤å€¼ï¼‰
RUNTIME_POOL_SIZE=
MAX_CONCURRENT_EXECUTIONS=
```

---

### Q4: å¦‚ä½•çŸ¥é“æŸä¸ªé…ç½®çš„é»˜è®¤å€¼ï¼Ÿ

**æ–¹æ³• 1**: æŸ¥çœ‹ `config/config.go` ä¸­çš„ `LoadConfig()` å‡½æ•°

**æ–¹æ³• 2**: æŸ¥çœ‹ `env.example` ä¸­çš„æ³¨é‡Š

**æ–¹æ³• 3**: å¯åŠ¨æœåŠ¡ï¼ŒæŸ¥çœ‹æ—¥å¿—ä¸­çš„å®žé™…é…ç½®

---

### Q5: è´Ÿæ•°ä¼šè§¦å‘è­¦å‘Šå—ï¼Ÿ

**å›žç­”**: è´Ÿæ•°èƒ½è§£æžä¸ºæ•´æ•°ï¼Œä½†ä¼šè¢«èŒƒå›´æ ¡éªŒæ•èŽ·å¹¶è°ƒæ•´ã€‚

```bash
RUNTIME_POOL_SIZE=-100

# æ—¥å¿—ï¼š
[WARN] RUNTIME_POOL_SIZE å°äºŽ MIN_RUNTIME_POOL_SIZEï¼Œå·²è°ƒæ•´
  original: -100
  adjusted: 50
```

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- `CONFIG_VALIDATION_ENHANCEMENT.md` - åŠŸèƒ½å®žæ–½è¯¦ç»†æŠ¥å‘Š
- `env.example` - å®Œæ•´çš„é…ç½®ç¤ºä¾‹å’Œè¯´æ˜Ž
- `env.development` - å¼€å‘çŽ¯å¢ƒæŽ¨èé…ç½®
- `env.production` - ç”Ÿäº§çŽ¯å¢ƒæŽ¨èé…ç½®

---

## ðŸ’¡ åé¦ˆä¸Žå»ºè®®

å¦‚æžœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. å‚è€ƒæœ¬æ–‡æ¡£çš„"å¸¸è§é—®é¢˜"éƒ¨åˆ†
3. æäº¤ Issue æè¿°é—®é¢˜

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åŽæ›´æ–°**: 2025-10-04  
**é€‚ç”¨ç‰ˆæœ¬**: >= v3.0

