# 环境配置
ENVIRONMENT=production

# 服务器配置
PORT=3002
GIN_MODE=release

# JavaScript 执行器配置
RUNTIME_POOL_SIZE=100
MIN_RUNTIME_POOL_SIZE=50
MAX_RUNTIME_POOL_SIZE=200
RUNTIME_IDLE_TIMEOUT_MIN=5
MAX_CONCURRENT_EXECUTIONS=1000
MAX_CODE_LENGTH=65535
MAX_INPUT_SIZE=2097152
MAX_RESULT_SIZE=5242880
EXECUTION_TIMEOUT_MS=300000
CODE_CACHE_SIZE=100
ALLOW_CONSOLE=false

# 🔥 熔断器配置（防止重度过载）
CIRCUIT_BREAKER_ENABLED=true           # 是否启用熔断器（默认：true）
CIRCUIT_BREAKER_MIN_REQUESTS=100       # 最小请求数（触发熔断的最小样本，默认：100）
CIRCUIT_BREAKER_FAILURE_RATIO=0.9      # 失败率阈值（0.0-1.0，默认：0.9 即 90%）
CIRCUIT_BREAKER_TIMEOUT_SEC=10         # Open 状态持续时间（秒，默认：10）
CIRCUIT_BREAKER_MAX_REQUESTS=100       # Half-Open 状态最大探测请求数（默认：100）

# Fetch API 配置
FETCH_TIMEOUT_MS=300000
MAX_FORMDATA_SIZE_MB=100
FORMDATA_STREAMING_THRESHOLD_MB=1
ENABLE_CHUNKED_UPLOAD=1
MAX_BLOB_FILE_SIZE_MB=100
FORMDATA_BUFFER_SIZE=2097152
MAX_FILE_SIZE_MB=50

# Go 运行时配置
GOMAXPROCS=0
GOGC=100

# ==================== 数据库配置 ====================
DB_HOST=localhost
DB_PORT=3306
DB_USER=flow_user
DB_PASSWORD=flow_password
DB_NAME=flow_codeblock_go
DB_MAX_OPEN_CONNS=100
DB_MAX_IDLE_CONNS=20
DB_CONN_MAX_LIFETIME_MIN=60
DB_CONN_MAX_IDLE_TIME_MIN=10

# ==================== Redis配置 ====================
REDIS_ENABLED=true
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_POOL_SIZE=100
REDIS_MIN_IDLE_CONNS=10
REDIS_DIAL_TIMEOUT_SEC=5
REDIS_READ_TIMEOUT_SEC=3
REDIS_WRITE_TIMEOUT_SEC=3
REDIS_MAX_RETRIES=3

# ==================== 认证配置 ====================
# 🔒 管理员Token（必需，用于访问管理接口）
# 
# ⚠️ 安全要求：
#   - 必须设置（不能为空，服务启动时会验证）
#   - 长度至少 16 个字符
#   - 必须使用强随机密码
#   - 绝不使用默认值、弱密码或包含 "admin"、"password"、"qingflow" 等常见词汇
#
# 📝 生成强密码（推荐方法）：
#   方法1（推荐）: openssl rand -base64 32
#   方法2: pwgen -s 32 1
#   方法3: 使用密码管理器（如 1Password、LastPass）生成
#
# 🔐 管理接口包括：
#   - Token 管理（创建/更新/删除/查询）
#   - 系统监控（健康检查、统计信息）
#   - 缓存管理（清空缓存、限流缓存）
#
# ⛔ 不安全的示例（请勿使用）：
#   ADMIN_TOKEN=qingflow7676          ❌ 旧默认值，已知漏洞
#   ADMIN_TOKEN=admin123              ❌ 包含弱密码
#   ADMIN_TOKEN=password              ❌ 常见密码
#   ADMIN_TOKEN=test                  ❌ 长度不足
#
# ✅ 安全的示例（生产环境请替换为自己生成的）：
#   ADMIN_TOKEN=J7k9mP2nQ5wX8vB3cD6fG1hL4sA0tY9uE
#
# 📌 请在下方设置您的强随机Token：
ADMIN_TOKEN=

TOKEN_CACHE_HOT_SIZE=500
TOKEN_CACHE_HOT_TTL_MINUTES=5
TOKEN_CACHE_REDIS_TTL_MINUTES=60

# 🔥 缓存写入池配置
# 说明：统一管理所有异步缓存写入，防止 goroutine 暴涨
CACHE_WRITE_POOL_WORKERS=15                # Worker 数量（推荐：10-20，默认：15）
CACHE_WRITE_POOL_QUEUE_SIZE=1500           # 队列大小（推荐：1000-2000，默认：1500）
CACHE_WRITE_POOL_SUBMIT_TIMEOUT_MS=50      # 提交超时（毫秒，推荐：50-100，默认：50）

# ==================== Token 限流配置 ====================
RATE_LIMIT_HOT_SIZE=500                    # Token限流热数据层大小
RATE_LIMIT_REDIS_TTL_MINUTES=60            # Token限流Redis TTL（分钟）
RATE_LIMIT_BATCH_SIZE=100                  # Token限流批量写入大小
RATE_LIMIT_DEFAULT_PER_MINUTE=60           # 默认每分钟限制（已废弃）
RATE_LIMIT_DEFAULT_BURST=10                # 默认突发限制（已废弃）
RATE_LIMIT_DEFAULT_WINDOW_SECONDS=60       # 默认时间窗口（已废弃）

# ==================== IP 限流配置 ====================
# 🔥 认证前 IP 限流（严格）- 防止暴力破解 Token
# 目标：防止单个 IP 尝试大量无效 Token
# 推荐配置：50 QPS 可以平衡安全性和用户体验
IP_RATE_LIMIT_PRE_AUTH=50          # 每秒允许的请求数（推荐：50，最低：10）
IP_RATE_LIMIT_PRE_AUTH_BURST=100   # 突发允许的请求数（推荐：100，最低：20）

# 🔥 认证后 IP 限流（宽松）- 防止极端滥用，不影响 Token 配额
# 目标：只防止极端滥用（例如单 IP 超过 200 QPS），不限制正常用户
# 注意：此限制应该比最高的 Token 配额更宽松
IP_RATE_LIMIT_POST_AUTH=200        # 每秒允许的请求数（默认：200）
IP_RATE_LIMIT_POST_AUTH_BURST=400  # 突发允许的请求数（默认：400）

# 🔥 全局 IP 限流（用于公开端点）
# 目标：保护健康检查等公开端点
IP_RATE_LIMIT_GLOBAL=50            # 每秒允许的请求数（默认：50）
IP_RATE_LIMIT_GLOBAL_BURST=100     # 突发允许的请求数（默认：100）

# ==================== 测试工具配置 ====================
# 测试工具页面配置（可选，有默认值）
# 访问地址：http://your-domain:port/flow/test-tool
TEST_TOOL_API_URL=http://localhost:3002
TEST_TOOL_AI_URL=https://qingflow.com/pc-ultron/share/agent/289302286342078465
TEST_TOOL_HELP_URL=https://exiao.yuque.com/ixwxsb/cqfg2y/or5052bo2dtukro2
TEST_TOOL_EXAMPLE_URL=https://exiao.yuque.com/rlf3k1/oanb79/tlty7ic7szfr2v7v?singleDoc#
TEST_TOOL_APPLY_URL=https://qingflow.com/f/9cah24om6402