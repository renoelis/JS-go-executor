# qs.stringify éå¸¸è§„ç±»å‹å¤„ç†å¯¹æ¯”æŠ¥å‘Š

## ğŸ“Š æµ‹è¯•ç¯å¢ƒ

- **Node ç‰ˆæœ¬**: v25.0.0
- **Goja ç¯å¢ƒ**: Go 1.25.3 + goja
- **qs ç‰ˆæœ¬**: v6.14.0
- **æµ‹è¯•æ—¥æœŸ**: 2025-11-06

---

## ğŸ” è¯¦ç»†å¯¹æ¯”ç»“æœ

### 1ï¸âƒ£ Symbol ç±»å‹

| æµ‹è¯•ç”¨ä¾‹ | Node v25.0.0 ç»“æœ | Goja ç»“æœ | ä¸€è‡´æ€§ |
|---------|------------------|-----------|--------|
| **Symbol ç±»å‹å­˜åœ¨** | âœ… function | âœ… function | âœ… ä¸€è‡´ |
| **åˆ›å»º Symbol** | `Symbol(test)` | `Symbol(test)` | âœ… ä¸€è‡´ |
| **stringify Symbol value** | `a=b&sym=Symbol%28test%29&c=d` | `a=b&sym=test&c=d` | âš ï¸ **å·®å¼‚** |
| **stringify Symbol key** | `a=b` (è·³è¿‡) | `a=b` (è·³è¿‡) | âœ… ä¸€è‡´ |
| **stringify multiple Symbols** | `a=Symbol%28s1%29&b=normal&c=Symbol%28s2%29` | `a=s1&b=normal&c=s2` | âš ï¸ **å·®å¼‚** |

**å·®å¼‚è¯´æ˜ï¼š**
- **Node**: Symbol è½¬æ¢ä¸ºå®Œæ•´å­—ç¬¦ä¸² `"Symbol(test)"`ï¼Œç„¶åè¿›è¡Œ URL ç¼–ç ï¼ˆæ‹¬å·ç¼–ç ä¸º `%28` å’Œ `%29`ï¼‰
- **Goja**: Symbol ä»…æå–æè¿°éƒ¨åˆ† `"test"`ï¼Œä¸åŒ…å« `Symbol()` åŒ…è£…

**å½±å“è¯„ä¼°ï¼š** è½»å¾®å·®å¼‚ï¼Œä½†å‡èƒ½æ­£å¸¸åºåˆ—åŒ–

---

### 2ï¸âƒ£ BigInt ç±»å‹

| æµ‹è¯•ç”¨ä¾‹ | Node v25.0.0 ç»“æœ | Goja ç»“æœ | ä¸€è‡´æ€§ |
|---------|------------------|-----------|--------|
| **BigInt ç±»å‹å­˜åœ¨** | âœ… function | âœ… function | âœ… ä¸€è‡´ |
| **åˆ›å»º BigInt** | `123` | `123` | âœ… ä¸€è‡´ |
| **stringify BigInt value** | `a=123&b=normal` | `b=normal` | âŒ **å·®å¼‚** |
| **stringify large BigInt** | `value=9007199254740991` | `""` (ç©º) | âŒ **å·®å¼‚** |
| **stringify negative BigInt** | `value=-456` | `""` (ç©º) | âŒ **å·®å¼‚** |
| **stringify mixed with BigInt** | `a=string&b=123&c=789&d=true` | `a=string&b=123&d=true` | âŒ **å·®å¼‚** |

**å·®å¼‚è¯´æ˜ï¼š**
- **Node**: BigInt è½¬æ¢ä¸ºæ•°å­—å­—ç¬¦ä¸²å¹¶æ­£å¸¸åºåˆ—åŒ–
- **Goja**: BigInt å€¼è¢«**å®Œå…¨è·³è¿‡**ï¼ˆç±»ä¼¼ undefined å¤„ç†ï¼‰

**å½±å“è¯„ä¼°ï¼š** âŒ **é‡å¤§å·®å¼‚** - Goja ä¸åºåˆ—åŒ– BigInt å€¼

---

### 3ï¸âƒ£ Buffer ç±»å‹

| æµ‹è¯•ç”¨ä¾‹ | Node v25.0.0 ç»“æœ | Goja ç»“æœ | ä¸€è‡´æ€§ |
|---------|------------------|-----------|--------|
| **Buffer ç±»å‹å­˜åœ¨** | âœ… function | âœ… function | âœ… ä¸€è‡´ |
| **åˆ›å»º Buffer** | `hello` | `hello` | âœ… ä¸€è‡´ |
| **stringify Buffer value** | `a=normal&buf=hello` | `a=normal` | âŒ **å·®å¼‚** |
| **stringify Buffer with encoding** | `data=world` | `""` (ç©º) | âŒ **å·®å¼‚** |
| **stringify empty Buffer** | `empty=` | `""` (ç©º) | âŒ **å·®å¼‚** |
| **stringify Buffer in array** | `buffers%5B0%5D=a&buffers%5B1%5D=b` | `""` (ç©º) | âŒ **å·®å¼‚** |
| **stringify Buffer in nested object** | `outer%5Binner%5D=nested` | `""` (ç©º) | âŒ **å·®å¼‚** |

**å·®å¼‚è¯´æ˜ï¼š**
- **Node**: Buffer è½¬æ¢ä¸ºå…¶å­—ç¬¦ä¸²å†…å®¹å¹¶æ­£å¸¸åºåˆ—åŒ–
- **Goja**: Buffer å€¼è¢«**å®Œå…¨è·³è¿‡**ï¼ˆç±»ä¼¼ undefined å¤„ç†ï¼‰

**å½±å“è¯„ä¼°ï¼š** âŒ **é‡å¤§å·®å¼‚** - Goja ä¸åºåˆ—åŒ– Buffer å€¼

---

### 4ï¸âƒ£ RegExp ç±»å‹ï¼ˆå¯¹ç…§ç»„ï¼‰

| æµ‹è¯•ç”¨ä¾‹ | Node v25.0.0 ç»“æœ | Goja ç»“æœ | ä¸€è‡´æ€§ |
|---------|------------------|-----------|--------|
| **stringify RegExp value** | `a=b&c=d` (è·³è¿‡) | `a=b&c=d` (è·³è¿‡) | âœ… ä¸€è‡´ |

**è¯´æ˜ï¼š** ä¸¤ç¯å¢ƒå‡æ­£ç¡®è·³è¿‡ RegExp å€¼

---

### 5ï¸âƒ£ Function ç±»å‹ï¼ˆå¯¹ç…§ç»„ï¼‰

| æµ‹è¯•ç”¨ä¾‹ | Node v25.0.0 ç»“æœ | Goja ç»“æœ | ä¸€è‡´æ€§ |
|---------|------------------|-----------|--------|
| **stringify Function value** | `a=b&c=d` (è·³è¿‡) | `a=b&c=d` (è·³è¿‡) | âœ… ä¸€è‡´ |

**è¯´æ˜ï¼š** ä¸¤ç¯å¢ƒå‡æ­£ç¡®è·³è¿‡ Function å€¼

---

## ğŸ“ˆ æ±‡æ€»ç»Ÿè®¡

| ç±»å‹ | ç¯å¢ƒæ”¯æŒ | Node è¡Œä¸º | Goja è¡Œä¸º | ä¸€è‡´æ€§ |
|------|---------|-----------|-----------|--------|
| **Symbol** | âœ… ä¸¤ç¯å¢ƒéƒ½æ”¯æŒ | è½¬ä¸º `"Symbol(desc)"` å­—ç¬¦ä¸² | ä»…æå– `"desc"` éƒ¨åˆ† | âš ï¸ è½»å¾®å·®å¼‚ |
| **BigInt** | âœ… ä¸¤ç¯å¢ƒéƒ½æ”¯æŒ | è½¬ä¸ºæ•°å­—å­—ç¬¦ä¸² | **è·³è¿‡ï¼ˆä¸åºåˆ—åŒ–ï¼‰** | âŒ é‡å¤§å·®å¼‚ |
| **Buffer** | âœ… ä¸¤ç¯å¢ƒéƒ½æ”¯æŒ | è½¬ä¸ºå­—ç¬¦ä¸²å†…å®¹ | **è·³è¿‡ï¼ˆä¸åºåˆ—åŒ–ï¼‰** | âŒ é‡å¤§å·®å¼‚ |
| **RegExp** | âœ… ä¸¤ç¯å¢ƒéƒ½æ”¯æŒ | è·³è¿‡ | è·³è¿‡ | âœ… ä¸€è‡´ |
| **Function** | âœ… ä¸¤ç¯å¢ƒéƒ½æ”¯æŒ | è·³è¿‡ | è·³è¿‡ | âœ… ä¸€è‡´ |

---

## ğŸ¯ ç»“è®ºä¸å»ºè®®

### âœ… å®Œå…¨ä¸€è‡´çš„ç±»å‹ï¼š
- **RegExp**: ä¸¤ç¯å¢ƒéƒ½è·³è¿‡ âœ…
- **Function**: ä¸¤ç¯å¢ƒéƒ½è·³è¿‡ âœ…

### âš ï¸ è½»å¾®å·®å¼‚çš„ç±»å‹ï¼š
- **Symbol**: 
  - Node: `"Symbol(test)"` â†’ `Symbol%28test%29`
  - Goja: `"Symbol(test)"` â†’ `test`
  - **å½±å“**: è½»å¾®ï¼Œä»…æ ¼å¼å·®å¼‚ï¼ŒåŠŸèƒ½æ­£å¸¸

### âŒ é‡å¤§å·®å¼‚çš„ç±»å‹ï¼š
- **BigInt**: 
  - Node: æ­£å¸¸åºåˆ—åŒ–ä¸ºæ•°å­—å­—ç¬¦ä¸²
  - Goja: **å®Œå…¨è·³è¿‡ï¼Œä¸åºåˆ—åŒ–**
  - **å½±å“**: é‡å¤§ - æ•°æ®ä¸¢å¤±

- **Buffer**: 
  - Node: æ­£å¸¸åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²å†…å®¹
  - Goja: **å®Œå…¨è·³è¿‡ï¼Œä¸åºåˆ—åŒ–**
  - **å½±å“**: é‡å¤§ - æ•°æ®ä¸¢å¤±

---

## ğŸ”§ å»ºè®®ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1: ä¿®æ”¹ Go å®ç°ï¼ˆæ¨èï¼‰

åœ¨ `enhance_modules/qs/stringify.go` ä¸­å¢åŠ å¯¹ BigInt å’Œ Buffer çš„å¤„ç†ï¼š

```go
// ä¼ªä»£ç ç¤ºä¾‹
func stringifyValue(value interface{}) string {
    switch v := value.(type) {
    case BigInt:  // goja çš„ BigInt ç±»å‹
        return v.String()
    case Buffer:  // goja çš„ Buffer ç±»å‹
        return string(v.Bytes())
    // ... å…¶ä»–ç±»å‹
    }
}
```

### æ–¹æ¡ˆ 2: æ–‡æ¡£åŒ–å·®å¼‚ï¼ˆå¤‡é€‰ï¼‰

å¦‚æœä¿®æ”¹æˆæœ¬é«˜ï¼Œå¯åœ¨æ–‡æ¡£ä¸­æ˜ç¡®è¯´æ˜ï¼š

> **âš ï¸ éå¸¸è§„ç±»å‹è¡Œä¸ºå·®å¼‚**
> - `BigInt`: Goja ç¯å¢ƒä¸æ”¯æŒåºåˆ—åŒ–ï¼Œä¼šè¢«è·³è¿‡
> - `Buffer`: Goja ç¯å¢ƒä¸æ”¯æŒåºåˆ—åŒ–ï¼Œä¼šè¢«è·³è¿‡
> - `Symbol`: ä»…åºåˆ—åŒ–æè¿°éƒ¨åˆ†ï¼ˆä¸å« `Symbol()` åŒ…è£…ï¼‰

### æ–¹æ¡ˆ 3: æµ‹è¯•ç”¨ä¾‹è°ƒæ•´ï¼ˆä¸´æ—¶ï¼‰

å½“å‰ `batch7` çš„æµ‹è¯•å·²åšå…¼å®¹å¤„ç†ï¼Œå…è®¸ goja è¿”å›ç©ºç»“æœï¼š

```javascript
// å½“å‰å®ç°
t('stringify BigInt value (or skipped)', 
  bigIntResult === 'a=123' || bigIntResult === '', 
  true);
```

---

## ğŸ“‹ æµ‹è¯•æ–‡ä»¶

**éªŒè¯è„šæœ¬**: `test/qs-native/qs.stringify/test_unconventional_types_verification.js`

**æ‰§è¡Œæ–¹æ³•ï¼š**
```bash
# Node ç¯å¢ƒ
node test/qs-native/qs.stringify/test_unconventional_types_verification.js

# Goja ç¯å¢ƒ
CODE=$(base64 < test/qs-native/qs.stringify/test_unconventional_types_verification.js)
curl --location 'http://localhost:3002/flow/codeblock' \
  --header 'Content-Type: application/json' \
  --header 'accessToken: flow_dfff6cb46b3c4b6fb49ce561811ce642503052b7517c98201518111cac23869e' \
  --data "{\"codebase64\": \"$CODE\", \"input\": {}}"
```

---

## ğŸ¯ æœ€ç»ˆå»ºè®®

**æ¨èæ–¹æ¡ˆ**: **ä¿®æ”¹ Go å®ç°ï¼Œå¢åŠ  BigInt å’Œ Buffer çš„åºåˆ—åŒ–æ”¯æŒ**

**ç†ç”±ï¼š**
1. **æ•°æ®å®Œæ•´æ€§**: é¿å…æ•°æ®ä¸¢å¤±
2. **ä¸€è‡´æ€§**: ä¸ Node.js å®˜æ–¹ qs è¡Œä¸ºå¯¹é½
3. **ç”¨æˆ·ä½“éªŒ**: é¿å…ä¸å¯é¢„æœŸçš„è¡Œä¸ºå·®å¼‚

**ä¼˜å…ˆçº§ï¼š**
- ğŸ”´ **é«˜ä¼˜å…ˆçº§**: BigInt æ”¯æŒï¼ˆæ•°å€¼è®¡ç®—åœºæ™¯å¸¸è§ï¼‰
- ğŸŸ¡ **ä¸­ä¼˜å…ˆçº§**: Buffer æ”¯æŒï¼ˆäºŒè¿›åˆ¶æ•°æ®åœºæ™¯ï¼‰
- ğŸŸ¢ **ä½ä¼˜å…ˆçº§**: Symbol æ ¼å¼å¯¹é½ï¼ˆå½±å“æœ‰é™ï¼‰

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-11-06  
**æµ‹è¯•æ‰§è¡Œäºº**: AI Assistant  
**æµ‹è¯•ç”¨ä¾‹æ•°**: 20 ä¸ª  
**å·®å¼‚å‘ç°**: 2 ä¸ªé‡å¤§å·®å¼‚ï¼ˆBigIntã€Bufferï¼‰




