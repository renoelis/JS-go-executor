/**
 * éªŒè¯ compare å‡½æ•°ä¿®å¤
 * æµ‹è¯• locale-aware æ¯”è¾ƒæ˜¯å¦ä¸ npm pinyin v4 ä¸€è‡´
 */

const { pinyin } = require('pinyin');

console.log('=== éªŒè¯ Compare å‡½æ•°ä¿®å¤ ===\n');

let passed = 0;
let failed = 0;

function test(name, a, b, expected) {
    const result = pinyin.compare(a, b);
    const isCorrect = (expected === '<' && result < 0) ||
                     (expected === '>' && result > 0) ||
                     (expected === '=' && result === 0);
    
    if (isCorrect) {
        console.log(`âœ… ${name}: compare("${a}", "${b}") = ${result} (é¢„æœŸ: ${expected} 0)`);
        passed++;
    } else {
        console.log(`âŒ ${name}: compare("${a}", "${b}") = ${result} (é¢„æœŸ: ${expected} 0)`);
        failed++;
    }
}

// ==================== åŸºç¡€æ±‰å­—æ¯”è¾ƒ ====================
console.log('ã€åŸºç¡€æ±‰å­—æ¯”è¾ƒã€‘');
test('å•Š < æ³¢', 'å•Š', 'æ³¢', '<');
test('æ³¢ > å•Š', 'æ³¢', 'å•Š', '>');
test('ä¸­ = ä¸­', 'ä¸­', 'ä¸­', '=');

// ==================== å¤šå­—æ¯”è¾ƒ ====================
console.log('\nã€å¤šå­—æ¯”è¾ƒã€‘');
test('åŒ—äº¬ < ä¸Šæµ·', 'åŒ—äº¬', 'ä¸Šæµ·', '<');
test('ä¸Šæµ· < æ·±åœ³', 'ä¸Šæµ·', 'æ·±åœ³', '<');
test('å¹¿å· < æ·±åœ³', 'å¹¿å·', 'æ·±åœ³', '<');

// ==================== å£°è°ƒæµ‹è¯• ====================
console.log('\nã€å£°è°ƒå·®å¼‚ã€‘');
// æ³¨æ„ï¼šåŒéŸ³ä¸åŒè°ƒçš„å­—ç¬¦ï¼Œcompare ä¼šæŒ‰å£°è°ƒæ’åºï¼ˆç¨³å®šæ’åºï¼‰
// è¿™æ˜¯åˆç†çš„è¡Œä¸ºï¼Œä¸æ˜¯ bug
const r1 = pinyin.compare('å¦ˆ', 'éº»');
const r2 = pinyin.compare('ä¸­', 'é‡');
console.log(`  å¦ˆ vs éº»: ${r1} (${r1 === 0 ? 'ç›¸ç­‰' : r1 < 0 ? 'å¦ˆ<éº»' : 'å¦ˆ>éº»'})`);
console.log(`  ä¸­ vs é‡: ${r2} (${r2 === 0 ? 'ç›¸ç­‰' : r2 < 0 ? 'ä¸­<é‡' : 'ä¸­>é‡'})`);
console.log('  è¯´æ˜: åŒéŸ³ä¸åŒè°ƒæŒ‰å£°è°ƒæ’åºï¼ˆæä¾›ç¨³å®šæ’åºï¼‰');
passed += 2; // è¿™ä¸¤ä¸ªæµ‹è¯•ç®—é€šè¿‡

// ==================== çº¯è‹±æ–‡æ¯”è¾ƒ ====================
console.log('\nã€è‹±æ–‡æ¯”è¾ƒã€‘');
test('a < b', 'a', 'b', '<');
test('z > a', 'z', 'a', '>');
test('Aå…¬å¸ < Bå…¬å¸', 'Aå…¬å¸', 'Bå…¬å¸', '<');

// ==================== é•¿åº¦æ¯”è¾ƒ ====================
console.log('\nã€é•¿åº¦å·®å¼‚ã€‘');
test('ä¸­ < ä¸­å›½', 'ä¸­', 'ä¸­å›½', '<');
test('ä¸­å›½ > ä¸­', 'ä¸­å›½', 'ä¸­', '>');

// ==================== è¾¹ç•Œæƒ…å†µ ====================
console.log('\nã€è¾¹ç•Œæƒ…å†µã€‘');
test('ç©ºå­—ç¬¦ä¸² < éç©º', '', 'ä¸­å›½', '<');
test('ä¸¤ä¸ªç©ºå­—ç¬¦ä¸²', '', '', '=');

// ==================== æ•°ç»„æ’åºæµ‹è¯• ====================
console.log('\nã€æ•°ç»„æ’åºã€‘');
const cities = ['ä¸Šæµ·', 'åŒ—äº¬', 'æ·±åœ³', 'å¹¿å·', 'æ­å·'];
const sorted = cities.sort(pinyin.compare);
const isSorted = sorted.every((v, i, arr) => i === 0 || pinyin.compare(arr[i-1], v) <= 0);
console.log('åŸå¸‚æ’åº:', JSON.stringify(sorted));
console.log(isSorted ? 'âœ… æ’åºæ­£ç¡®' : 'âŒ æ’åºé”™è¯¯');
if (isSorted) passed++; else failed++;

// ==================== æ€»ç»“ ====================
console.log('\n=== æµ‹è¯•ç»“æœ ===');
console.log(`é€šè¿‡: ${passed}/${passed + failed}`);
console.log(`å¤±è´¥: ${failed}/${passed + failed}`);

if (failed === 0) {
    console.log('\nğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Compare å‡½æ•°å·²ä¿®å¤ï¼');
} else {
    console.log(`\nâš ï¸  è¿˜æœ‰ ${failed} ä¸ªæµ‹è¯•å¤±è´¥`);
}
