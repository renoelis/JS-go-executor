# 测试工具配额显示优化说明

## 🎯 优化目标

优化Token查询界面，更好地融合**时间限制**和**次数限制**两种配额信息的展示。

---

## ✅ 优化内容

### 1. 新增配额类型显示

**显示位置**：Token详情的第三项

**显示内容**：
- ⏰ **time类型**：时间限制（不限次数） - 青色 `#00acc1`
- 🔢 **count类型**：次数限制（永久有效） - 橙色 `#ff9800`
- ⚡ **hybrid类型**：时间+次数双重限制 - 粉色 `#e91e63`

---

### 2. 新增配额使用情况可视化

**仅对count和hybrid类型显示**

#### 显示效果

```
配额使用情况
┌────────────────────────────┐
│  75 / 100  次              │  ← 大号数字，颜色根据剩余比例变化
│  ████████░░  75%           │  ← 进度条
│  剩余 75% · 已使用 25 次   │  ← 详细说明
└────────────────────────────┘
```

#### 颜色规则

| 剩余比例 | 颜色 | 含义 |
|---------|------|------|
| ≥ 50% | 绿色 `#28a745` | 充足 |
| 20% - 50% | 黄色 `#ffc107` | 警告 |
| < 20% | 红色 `#dc3545` | 不足 |

---

## 📊 三种类型的显示对比

### Time类型（仅时间限制）

```
┌─────────────────────────────────┐
│ Token 值: flow_abc123...        │
│ 状态: ✅ 有效                   │
│ 配额类型: ⏰ 时间限制（不限次数）│  ← 青色
│ 失效时间: 2025-10-20 12:00:00  │
│ 每分钟请求限制: 60              │
│ 突发请求限制: 100               │
│ 创建时间: 2025-10-18 10:00:00  │
└─────────────────────────────────┘
```

**特点**：
- ✅ 显示配额类型
- ❌ 不显示配额使用情况（因为不限次数）
- ✅ 显示失效时间

---

### Count类型（仅次数限制）

```
┌─────────────────────────────────┐
│ Token 值: flow_def456...        │
│ 状态: ✅ 有效                   │
│ 配额类型: 🔢 次数限制（永久有效）│  ← 橙色
│                                 │
│ 配额使用情况                    │  ← 新增
│   75 / 100  次                  │  ← 绿色（75%）
│   ████████░░  75%               │  ← 进度条
│   剩余 75% · 已使用 25 次       │
│                                 │
│ 失效时间: 永久有效              │
│ 每分钟请求限制: 60              │
│ 突发请求限制: 100               │
│ 创建时间: 2025-10-18 10:00:00  │
└─────────────────────────────────┘
```

**特点**：
- ✅ 显示配额类型
- ✅ 显示配额使用情况（带进度条）
- ✅ 显示"永久有效"

---

### Hybrid类型（时间+次数双重限制）

```
┌─────────────────────────────────┐
│ Token 值: flow_ghi789...        │
│ 状态: ✅ 有效                   │
│ 配额类型: ⚡ 时间+次数双重限制  │  ← 粉色
│                                 │
│ 配额使用情况                    │  ← 新增
│   15 / 100  次                  │  ← 黄色（15%）
│   ██░░░░░░░░  15%               │  ← 进度条
│   剩余 15% · 已使用 85 次       │
│                                 │
│ 失效时间: 2025-10-20 12:00:00  │
│ 每分钟请求限制: 60              │
│ 突发请求限制: 100               │
│ 创建时间: 2025-10-18 10:00:00  │
└─────────────────────────────────┘
```

**特点**：
- ✅ 显示配额类型
- ✅ 显示配额使用情况（带进度条）
- ✅ 显示失效时间
- ⚠️ 满足任一条件即失效

---

## 🎨 UI设计细节

### 1. 配额类型标签

```css
/* 不同类型使用不同颜色 */
.quota-type-time {
    color: #00acc1;  /* 青色 - 时间 */
}

.quota-type-count {
    color: #ff9800;  /* 橙色 - 次数 */
}

.quota-type-hybrid {
    color: #e91e63;  /* 粉色 - 双重 */
}
```

### 2. 配额进度条

```html
<!-- 进度条容器 -->
<div style="background: #e9ecef; height: 8px; border-radius: 4px;">
    <!-- 进度条填充 -->
    <div style="background: ${quotaColor}; width: ${quotaPercent}%;"></div>
</div>
```

**动态颜色**：
- 绿色：剩余 ≥ 50%
- 黄色：剩余 20% - 50%
- 红色：剩余 < 20%

### 3. 数字显示

```html
<span style="font-size: 20px; font-weight: bold; color: ${quotaColor};">
    75 / 100
</span>
<span style="color: #6c757d; font-size: 13px;">次</span>
```

**特点**：
- 大号字体（20px）
- 粗体显示
- 动态颜色
- 单位说明

---

## 💡 使用场景示例

### 场景1：查询time类型Token

**用户操作**：
1. 点击"查询Token"
2. 输入ws_id和email
3. 点击"查询"

**显示结果**：
```
✅ 查询成功！找到 1 个 Token

配额类型: ⏰ 时间限制（不限次数）
失效时间: 2025-10-20 12:00:00
```

**用户理解**：
- ✅ 这是时间限制型Token
- ✅ 在2025-10-20之前可以无限次使用
- ✅ 不需要担心次数用完

---

### 场景2：查询count类型Token（配额充足）

**显示结果**：
```
✅ 查询成功！找到 1 个 Token

配额类型: 🔢 次数限制（永久有效）

配额使用情况
  80 / 100  次
  ████████░░  80%
  剩余 80% · 已使用 20 次
```

**用户理解**：
- ✅ 这是次数限制型Token
- ✅ 永久有效，不会过期
- ✅ 还剩80次，很充足（绿色）
- ✅ 可以放心使用

---

### 场景3：查询count类型Token（配额不足）

**显示结果**：
```
✅ 查询成功！找到 1 个 Token

配额类型: 🔢 次数限制（永久有效）

配额使用情况
  15 / 100  次
  ██░░░░░░░░  15%
  剩余 15% · 已使用 85 次
```

**用户理解**：
- ⚠️ 配额只剩15%（黄色警告）
- ⚠️ 已经使用了85次
- ⚠️ 需要考虑续费或增购

---

### 场景4：查询hybrid类型Token

**显示结果**：
```
✅ 查询成功！找到 1 个 Token

配额类型: ⚡ 时间+次数双重限制

配额使用情况
  30 / 50  次
  ██████░░░░  60%
  剩余 60% · 已使用 20 次

失效时间: 2025-10-25 12:00:00
```

**用户理解**：
- ✅ 这是双重限制型Token
- ✅ 还剩30次（60%，绿色）
- ✅ 2025-10-25过期
- ⚠️ 满足任一条件即失效（用完或过期）

---

## 🔧 技术实现

### 1. 配额类型判断

```javascript
const quotaType = tokenData.quota_type || 'time';

if (quotaType === 'time') {
    quotaTypeText = '⏰ 时间限制（不限次数）';
    quotaTypeColor = '#00acc1';
} else if (quotaType === 'count') {
    quotaTypeText = '🔢 次数限制（永久有效）';
    quotaTypeColor = '#ff9800';
} else if (quotaType === 'hybrid') {
    quotaTypeText = '⚡ 时间+次数双重限制';
    quotaTypeColor = '#e91e63';
}
```

### 2. 配额进度计算

```javascript
if (quotaType === 'count' || quotaType === 'hybrid') {
    const quotaPercent = totalQuota > 0 
        ? (remainingQuota / totalQuota * 100).toFixed(1) 
        : 0;
    
    // 根据剩余比例选择颜色
    let quotaColor = '#28a745';  // 绿色
    if (quotaPercent < 20) {
        quotaColor = '#dc3545';  // 红色
    } else if (quotaPercent < 50) {
        quotaColor = '#ffc107';  // 黄色
    }
}
```

### 3. 动态HTML生成

```javascript
let quotaStatusHTML = '';
if (quotaType === 'count' || quotaType === 'hybrid') {
    quotaStatusHTML = `
        <div class="token-item">
            <div class="token-label">配额使用情况</div>
            <div class="token-value">
                <!-- 数字显示 -->
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 20px; font-weight: bold; color: ${quotaColor};">
                        ${remainingQuota || 0} / ${totalQuota || 0}
                    </span>
                    <span style="color: #6c757d; font-size: 13px;">次</span>
                </div>
                <!-- 进度条 -->
                <div style="background: #e9ecef; height: 8px; border-radius: 4px;">
                    <div style="background: ${quotaColor}; width: ${quotaPercent}%;"></div>
                </div>
                <!-- 详细说明 -->
                <div style="margin-top: 5px; font-size: 12px; color: #6c757d;">
                    剩余 ${quotaPercent}% · 已使用 ${totalQuota - remainingQuota} 次
                </div>
            </div>
        </div>
    `;
}
```

---

## 📋 优化前后对比

### 优化前

```
Token 值: flow_abc123...
状态: ✅ 有效
失效时间: 2025-10-20 12:00:00
每分钟请求限制: 60 次/分钟
突发请求限制: 100 次
创建时间: 2025-10-18 10:00:00
```

**问题**：
- ❌ 不知道是什么类型的Token
- ❌ 不知道还剩多少次
- ❌ 无法直观判断配额状态

---

### 优化后

```
Token 值: flow_abc123...
状态: ✅ 有效
配额类型: 🔢 次数限制（永久有效）  ← 新增

配额使用情况                        ← 新增
  75 / 100  次
  ████████░░  75%
  剩余 75% · 已使用 25 次

失效时间: 永久有效
每分钟请求限制: 60
突发请求限制: 100
创建时间: 2025-10-18 10:00:00
```

**优点**：
- ✅ 清楚显示配额类型
- ✅ 直观显示剩余次数
- ✅ 进度条可视化
- ✅ 颜色警示（绿/黄/红）

---

## 🎉 总结

### 优化内容

1. ✅ 新增配额类型显示（3种类型，不同颜色）
2. ✅ 新增配额使用情况（进度条+百分比）
3. ✅ 动态颜色警示（绿色/黄色/红色）
4. ✅ 更好地融合时间和次数信息

### 适用场景

- ✅ 单个Token查询
- ✅ 多个Token选择
- ✅ time/count/hybrid三种类型

### 用户体验

- ✅ 一目了然的配额状态
- ✅ 直观的进度条展示
- ✅ 清晰的类型说明
- ✅ 智能的颜色警示

---

**优化版本**: v1.1  
**优化时间**: 2025-10-19  
**影响文件**: `templates/test-tool.html`
